name: Docker Build & Publish

on:
  push:
    branches:
      - docker_test

jobs:
  build_and_publish:
    runs-on: ubuntu-latest

    steps:
      - name: Configure SSH key
        run: |
          mkdir -p ~/.ssh/
          echo "${{ secrets.SSH_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts

      - name: Clone GitHub repository
        run: git clone git@github.com:AgrimarketUN/AWS-Terraform-Pipeline.git

      - name: Configurar identidad de usuario en Git
        run: |
          cd AWS-Terraform-Pipeline
          git config user.email "dmirandam@unal.edu.co"
          git config user.name "dmirandam"

      - name: Create File
        run: |
          cd AWS-Terraform-Pipeline
          touch "a"
          ls -al
          git init
          git status

      - name: Commit to GitHub repository
        run: | 
          cd AWS-Terraform-Pipeline
          git add .
          git commit -m "Add Docker image"

      - name: Push changes to GitHub repository
        run: |
          cd AWS-Terraform-Pipeline
          git push
